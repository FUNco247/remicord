"use strict";function _createForOfIteratorHelper(e,t){var r,n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length)return n&&(e=n),r=0,{s:t=function(){},n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,a=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw a}}}}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function asyncGeneratorStep(e,t,r,n,a,o,c){try{var i=e[o](c),u=i.value}catch(e){return void r(e)}i.done?t(u):Promise.resolve(u).then(n,a)}function _asyncToGenerator(i){return function(){var e=this,c=arguments;return new Promise(function(t,r){var n=i.apply(e,c);function a(e){asyncGeneratorStep(n,t,r,a,o,"next",e)}function o(e){asyncGeneratorStep(n,t,r,a,o,"throw",e)}a(void 0)})}}var records,dateStart=document.querySelector("input.dateStart"),dateEnd=document.querySelector("input.dateEnd"),getHistoryBtn=document.querySelector("button.getHistoryBtn"),setDate=function(){var e=new Date,t=String(e.getFullYear()),r=(r=String(e.getMonth()+1))<10?"0"+r:r,e=(e=String(e.getDate()))<10?"0"+e:e;dateStart.value="".concat(t,"-").concat(r,"-").concat(e),dateEnd.value="".concat(t,"-").concat(r,"-").concat(e)},dateValidCheck=(setDate(),function(){var e=new Date(dateStart.value),t=new Date(dateEnd.value);return 364<(t.getTime()-e.getTime())/864e5?(alert("최대 조회 가능 기간은 1년입니다."),location.reload()):e.getTime()>t.getTime()?(alert("시작일이 종료일 이후입니다."),location.reload()):void 0}),drawHistoryTable=function(){var t=_asyncToGenerator(regeneratorRuntime.mark(function e(t){var r,n,a,o,c,u,d,l,s,f,y,m,p,h,v,T,g,S,w;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(r=Object.keys(t),(n=document.querySelector("div.showHistory")).innerHTML&&(n.innerHTML=""),a=document.createElement("table"),o=document.createElement("thead"),c=document.createElement("tbody"),u=document.createElement("tr"),d=["날짜","현장명","거리(km)","폐수","OT","야간","주유량(L)","메모"],i=0;i<d.length;i++)(l=document.createElement("th")).innerText=d[i],u.appendChild(l);for(o.appendChild(u),s=["date","siteName","distance","water","overTime","nightSupport","oiling","memo"],f=0,y=r;f<y.length;f++){w=y[f],w=t[w],m=!1,p=_createForOfIteratorHelper(w);try{for(p.s();!(h=p.n()).done;){for(record=h.value,(v=document.createElement("tr")).classList.add("dayRecord"),T=0;T<s.length;T++)g=s[T],S=document.createElement("td"),record[g]?S.innerText=record[g]:S.innerText="-",S.classList.add("".concat(g)),v.appendChild(S),T===s.length-1&&(m=!0);c.appendChild(v)}}catch(e){p.e(e)}finally{p.f()}m&&((w=document.createElement("tr")).classList.add("daySum"),w.innerText="소계",c.appendChild(w))}a.appendChild(o),a.appendChild(c),n.appendChild(a);case 15:case"end":return e.stop()}},e)}));return function(e){return t.apply(this,arguments)}}(),getHistoryJson=function(){var e=_asyncToGenerator(regeneratorRuntime.mark(function e(){var t,r,n,a;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return dateValidCheck(),r=new URL("http://localhost:8282/record/history/api"),t={startDate:dateStart.value,endDate:dateEnd.value},r.search=new URLSearchParams(t).toString(),e.next=6,fetch(r).then(function(e){return e.json()}).then(function(e){records=e}).catch(function(e){console.log("request failed",e)});case 6:return e.next=8,drawHistoryTable(records);case 8:t=document.querySelectorAll("td.date"),r=document.querySelectorAll("td.water"),n=document.querySelectorAll("td.overTime"),a=document.querySelectorAll("td.nightSupport"),t.forEach(function(e){return e.innerText=e.innerText.split("T")[0]}),r.forEach(function(e){return e.innerText="true"==e.innerText?"O":e.innerText}),n.forEach(function(e){return e.innerText="true"==e.innerText?"O":e.innerText}),a.forEach(function(e){return e.innerText="true"==e.innerText?"O":e.innerText});case 16:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();getHistoryBtn.addEventListener("click",getHistoryJson);